(awk ' BEGIN { RS="(frontend|listen|backend) ";FS="\n" };$1 !~ "#" {print "backend "$1; {for (i=1;i<=NF;i++) if ($i ~ "^[[:space:]]*server") {print $i}}} ' ../haproxy_svr/roles/haproxy/templates/* | awk 'BEGIN { RS="backend ";FS="\n";ip = "(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]):[0-9]*" }; /server/ { for(i=1;i<=NF;i++){ reg = match($i,ip) ; if (reg!=0 && $i!~/#/) print $1" "substr($i, RSTART, RLENGTH)  } }'| sed 's/\r//;s/:/ /'|awk '!x[$2,$3]++') | awk '{split($0,a," ");OFS = " "; print a[2],a[3];}'
